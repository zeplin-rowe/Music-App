{"version":3,"sources":["../src/localStorageBroadcastChannel.ts"],"sourcesContent":["type Listener<T> = (e: MessageEvent<T>) => void;\n\nconst KEY_PREFIX = '__lsbc__';\n\nexport class LocalStorageBroadcastChannel<E> {\n  private readonly eventTarget = window;\n  private readonly channelKey: string;\n\n  constructor(name: string) {\n    this.channelKey = KEY_PREFIX + name;\n    this.setupLocalStorageListener();\n  }\n\n  public postMessage = (data: E): void => {\n    if (typeof window === 'undefined') {\n      // Silently do nothing\n      return;\n    }\n\n    try {\n      window.localStorage.setItem(this.channelKey, JSON.stringify(data));\n      window.localStorage.removeItem(this.channelKey);\n    } catch {\n      // Silently do nothing\n    }\n  };\n\n  public addEventListener = (eventName: 'message', listener: Listener<E>): void => {\n    this.eventTarget.addEventListener(this.prefixEventName(eventName), e => {\n      listener(e as MessageEvent);\n    });\n  };\n\n  private setupLocalStorageListener = () => {\n    const notifyListeners = (e: StorageEvent) => {\n      if (e.key !== this.channelKey || !e.newValue) {\n        return;\n      }\n\n      try {\n        const data = JSON.parse(e.newValue || '');\n        const event = new MessageEvent(this.prefixEventName('message'), {\n          data,\n        });\n        this.eventTarget.dispatchEvent(event);\n      } catch {\n        //\n      }\n    };\n\n    window.addEventListener('storage', notifyListeners);\n  };\n\n  private prefixEventName(eventName: string): string {\n    return this.channelKey + eventName;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,IAAM,aAAa;AAEZ,IAAM,+BAAN,MAAsC;AAAA,EAC1B,cAAc;AAAA,EACd;AAAA,EAEjB,YAAY,MAAc;AACxB,SAAK,aAAa,aAAa;AAC/B,SAAK,0BAA0B;AAAA,EACjC;AAAA,EAEO,cAAc,CAAC,SAAkB;AACtC,QAAI,OAAO,WAAW,aAAa;AAEjC;AAAA,IACF;AAEA,QAAI;AACF,aAAO,aAAa,QAAQ,KAAK,YAAY,KAAK,UAAU,IAAI,CAAC;AACjE,aAAO,aAAa,WAAW,KAAK,UAAU;AAAA,IAChD,QAAQ;AAAA,IAER;AAAA,EACF;AAAA,EAEO,mBAAmB,CAAC,WAAsB,aAAgC;AAC/E,SAAK,YAAY,iBAAiB,KAAK,gBAAgB,SAAS,GAAG,OAAK;AACtE,eAAS,CAAiB;AAAA,IAC5B,CAAC;AAAA,EACH;AAAA,EAEQ,4BAA4B,MAAM;AACxC,UAAM,kBAAkB,CAAC,MAAoB;AAC3C,UAAI,EAAE,QAAQ,KAAK,cAAc,CAAC,EAAE,UAAU;AAC5C;AAAA,MACF;AAEA,UAAI;AACF,cAAM,OAAO,KAAK,MAAM,EAAE,YAAY,EAAE;AACxC,cAAM,QAAQ,IAAI,aAAa,KAAK,gBAAgB,SAAS,GAAG;AAAA,UAC9D;AAAA,QACF,CAAC;AACD,aAAK,YAAY,cAAc,KAAK;AAAA,MACtC,QAAQ;AAAA,MAER;AAAA,IACF;AAEA,WAAO,iBAAiB,WAAW,eAAe;AAAA,EACpD;AAAA,EAEQ,gBAAgB,WAA2B;AACjD,WAAO,KAAK,aAAa;AAAA,EAC3B;AACF;","names":[]}